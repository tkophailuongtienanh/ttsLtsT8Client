{"version":3,"sources":["pages/User/UserManagement.js"],"names":["roleOption","value","code","label","UserManagement","addToast","useToast","search","setSearch","useState","users","setUsers","currentPage","setCurrentPage","total","setTotal","columns","title","dataIndex","key","render","_","record","React","createElement","Space","size","Fragment","Select","mode","maxTagCount","permissionCodes","onChange","updateUserRole","id","className","style","minWidth","filterOption","showSearch","options","async","userId","response","fetchWithAuth","body","UserId","Permission","data","updatedUsers","map","u","errorCode","message","error","console","log","searchUser","pageIndex","arguments","length","undefined","pageSize","searchStr","getWithAuth","teamMembersWithKey","list","member","permissions","perm","roleId","useEffect","Card","Input","type","placeholder","e","target","Button","onClick","btnSearchClick","Table","dataSource","pagination","Pagination","align","current","curpage"],"mappings":"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","file":"static/js/23.f337593f.chunk.js","sourcesContent":["import { replace } from \"react-router-dom\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { Button, Card, Input, Pagination, Select, Space, Table } from \"antd\";\r\nimport fetchWithAuth, { fetchApi, getWithAuth } from \"../../utils/callApi\";\r\nimport { useToast } from \"../../context/ToastContext\";\r\n\r\nconst PAGESIZE = 25;\r\nconst roleOption = [\r\n  { value: 1, code: \"Leader\", label: \"Leader\" },\r\n  { value: 2, code: \"Designer\", label: \"Designer\" },\r\n  { value: 3, code: \"Deliver\", label: \"Deliver\" },\r\n  { value: 4, code: \"Manager\", label: \"Manager\" },\r\n  { value: 5, code: \"Employee\", label: \"Employee\" },\r\n  { value: 6, code: \"Admin\", label: \"Admin\" },\r\n];\r\nconst UserManagement = () => {\r\n  const addToast = useToast();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [users, setUsers] = useState([]);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [total, setTotal] = useState(0);\r\n  const columns = [\r\n    {\r\n      title: \"ID\",\r\n      dataIndex: \"id\",\r\n      key: \"id\",\r\n      // render: (_, record) => <p>{record.age}</p>,\r\n    },\r\n    {\r\n      title: \"Họ và tên\",\r\n      dataIndex: \"fullName\",\r\n      key: \"fullName\",\r\n    },\r\n    {\r\n      title: \"Email\",\r\n      dataIndex: \"email\",\r\n      key: \"email\",\r\n    },\r\n    {\r\n      title: \"Phone\",\r\n      dataIndex: \"phoneNumber\",\r\n      key: \"phoneNumber\",\r\n    },\r\n    {\r\n      title: \"Quyền hạn\",\r\n      key: \"action\",\r\n      render: (_, record) => (\r\n        <Space size=\"middle\">\r\n          <>\r\n            <Select\r\n              mode=\"multiple\"\r\n              maxTagCount=\"responsive\"\r\n              value={record.permissionCodes}\r\n              onChange={(value) => updateUserRole(record.id, value)}\r\n              //   className=\"block w-full text-sm focus:outline-none dark:text-gray-300 form-input leading-5 focus:border-purple-400 dark:border-gray-600 focus:shadow-outline-purple dark:focus:border-gray-600 dark:focus:shadow-outline-gray dark:bg-gray-700 mt-1\"\r\n              className=\"w-60 mt-1 \"\r\n              style={{ minWidth: \"280px\" }}\r\n              //   labelInValue\r\n              filterOption={false}\r\n              showSearch\r\n              options={roleOption}\r\n            />\r\n          </>\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n  const updateUserRole = async (userId, value) => {\r\n    try {\r\n      const response = await fetchWithAuth(\"Users/UpdateUserPermission\", {\r\n        body: { UserId: userId, Permission: value },\r\n      });\r\n      const data = response.data;\r\n      if (response.code == \"200\") {\r\n        const updatedUsers = users.map((u) =>\r\n          u.id == userId ? { ...u, permissionCodes: value } : u\r\n        );\r\n        setUsers(updatedUsers);\r\n      } else if (response.code) {\r\n        addToast(\r\n          \"danger\",\r\n          response.code + \": \" + data.errorCode + \"-\" + data.message,\r\n          10000\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n  const searchUser = async (\r\n    pageIndex = currentPage - 1,\r\n    pageSize = PAGESIZE,\r\n    searchStr = search\r\n  ) => {\r\n    try {\r\n      const response = await getWithAuth(\r\n        \"Users/GetAll?\" +\r\n          \"search=\" +\r\n          searchStr +\r\n          \"&pageIndex=\" +\r\n          pageIndex +\r\n          \"&pageSize=\" +\r\n          pageSize\r\n      );\r\n      const data = response.data;\r\n\r\n      if (response.code == \"200\") {\r\n        const teamMembersWithKey = data.list.map((member) => ({\r\n          ...member,\r\n          key: member.id, // Hoặc sử dụng một thuộc tính duy nhất khác\r\n          permissionCodes: member.permissions.map((perm) => perm.roleId),\r\n        }));\r\n        setTotal(data.total);\r\n        setUsers(teamMembersWithKey);\r\n      } else if (response.code) {\r\n        addToast(\r\n          \"danger\",\r\n          response.code + \": \" + data.errorCode + \"-\" + data.message,\r\n          10000\r\n        );\r\n      }\r\n    } catch (error) {}\r\n  };\r\n  const btnSearchClick = () => {\r\n    setCurrentPage(1);\r\n    searchUser(currentPage - 1, PAGESIZE, search);\r\n  };\r\n  const onChange = (curpage, pageSize) => {\r\n    setCurrentPage(curpage);\r\n    searchUser(curpage - 1, pageSize);\r\n  };\r\n  useEffect(() => {\r\n    searchUser();\r\n  }, []);\r\n  return (\r\n    <>\r\n      <Card className=\"mt-5 shadow-md border-0\">\r\n        <Input\r\n          className=\"mb-3 p-2 w-1/2 mr-3\"\r\n          type=\"text\"\r\n          placeholder=\"Tên, email người dùng\"\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          value={search}\r\n        ></Input>\r\n        <Button\r\n          onClick={btnSearchClick}\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          className=\"h-full\"\r\n        >\r\n          <i className=\"fa-solid fa-magnifying-glass\"></i> Tìm kiếm\r\n        </Button>\r\n        <Table columns={columns} dataSource={users} pagination={false} />\r\n        <Pagination\r\n          className=\"mt-2\"\r\n          align=\"end\"\r\n          current={currentPage}\r\n          onChange={onChange}\r\n          total={total}\r\n          pageSize={PAGESIZE}\r\n        />\r\n      </Card>\r\n      ;\r\n    </>\r\n  );\r\n};\r\nexport default UserManagement;\r\n"],"sourceRoot":""}